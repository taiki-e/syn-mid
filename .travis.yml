language: rust
sudo: false
cache: cargo

matrix:
  fast_finish: true

  include:
    # This is the minimum Rust version supported by syn-mid.
    # When updating this, the reminder to update the minimum required version in README.md.
    - rust: 1.15.1 # https://github.com/dtolnay/syn/blob/master/.travis.yml

    - rust: stable
      env: TEST=1
    - rust: beta
      env: TEST=1
    - rust: nightly
      env: TEST=1

    - rust: nightly
      name: cargo test (minimal versions)
      script:
        - cargo update -Zminimal-versions
        - cargo test --all-features

    - rust: nightly
      name: cargo clippy
      script:
        - if rustup component add clippy-preview;
          then
            cargo clippy --all-features -- -Dwarnings;
          else
            echo 'Skipping clippy';
          fi

    - rust: nightly
      name: cargo doc
      script:
        - RUSTDOCFLAGS=-Dwarnings cargo doc --no-deps --all-features

before_script:
  - set -o errexit

script:
  - if [ "$TEST" = 1 ]; then cargo test --all --all-features; fi
  - build
  - build --features full
  - build --no-default-features --features derive
  - build --no-default-features --features full
  - build --all-features

notifications:
  email:
    on_success: never
